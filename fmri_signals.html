<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. FMRI signals &mdash; Statistics for the CogMaster</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2013',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <link rel="top" title="Statistics for the CogMaster" href="index.html" />
    <link rel="next" title="2.1. Getting ready: installing the software" href="install.html" />
    <link rel="prev" title="1. Basic statistics" href="basic_statistics.html" /> 
  </head>
  <body>
   <!-- Use the header to add javascript -->
    
    <script type="text/javascript">
    // Function to collapse the tip divs
    function collapse_tip_div(obj){
	// Update the representation on the tip div based on whether it
	// has the 'collapsed' css class or not: we only want to
	// collapse divs that are not already collapsed
	if($(obj).hasClass("collapsed")) {
	} else {
	    $(obj).find("p.summary").remove();
	    var content = $(obj).text();
	    var html = $(obj).html();

	    if(content.length > 40) {
		if ($.browser.msie) {
		    // We start at '3' to avoid 'tip', as IE
		    // does not count whitespace
		    var content = content.substr(3, 50);
		} else {
		    // We start at '5' to avoid 'tip '
		    var content = content.substr(5, 50);
		}
	    }
	    $(obj).html('<p class="summary"><img src="_static/plus.png">' + content + '...</p>' + html);
	}
    }
    </script>

    <script type="text/javascript">
    $(function () {
	$(".tip")
	    .click(function(event){
		$(this).toggleClass("collapsed");
		// Change state of the global button
		$('div.related li.transparent').removeClass('transparent')
		$(this).find("p.summary").remove();
		if($(this).hasClass("collapsed")) {
		    var content = $(this).text();
		    var html = $(this).html();
    
		    if(content.length > 40) {
			if ($.browser.msie) {
			    // We start at '3' to avoid 'tip', as IE
			    // does not count whitespace
			    var content = content.substr(3, 50);
			} else {
			    // We start at '5' to avoid 'tip '
			    var content = content.substr(5, 50);
			}
		    }
		    $(this).html('<p class="summary"><img src="_static/plus.png">' + content + '...</p>' + html);
		}
		if (event.target.tagName.toLowerCase() != "a") {
                   return true; //Makes links clickable
		}
	});
    });
    </script>


    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="install.html" title="2.1. Getting ready: installing the software"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="basic_statistics.html" title="1. Basic statistics"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Statistics for the CogMaster</a> &raquo;</li>
     
    <!-- Insert a menu in the navigation bar -->
    <li class="left">
	<!-- On click toggle the 'tip' on or off-->
	<a onclick="$('.tip').each(function (index, obj) {
			    collapse_tip_div(obj);
		    });
		    $('.tip').addClass('collapsed');
		    $('.left').addClass('transparent');">
	<img src="_static/minus.png"
         alt="Collapse to compact view" style="padding: 1ex;"/>
	<span class="hiddenlink">Collapse document to compact view</span>
    </a></li>

      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="fmri-signals">
<h1>2. FMRI signals<a class="headerlink" href="#fmri-signals" title="Permalink to this headline">¶</a></h1>
<p>Here we will cover fMRI signals and their analysis.</p>
<div class="topic">
<p class="topic-title first">This page content</p>
<p>The aim of this first part is to get familiar with fMRI data.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Carve in your mind that the only characters you can safely use in a
file name are non-accented upper and lower case letters, numbers and two
special characters: the underscore &#8220;_&#8221; and the dot &#8221;.&#8221; . Don&#8217;t cry if you
run into problems with file names including accents and space.</p>
<p class="last">Most of the problems one has to solve in any hands-on lab course are
related to the students not knowing how to deal with the file structure
of their own computer. If you are still unsure about concepts such as
&#8220;home directory&#8221;, &#8220;working directory&#8221;, or &#8220;path&#8221;, go back to your first
lectures on python by Christophe Pallier and make sure you are able to
explertly navigate in your file structure.</p>
</div>
<div class="topic">
<p class="topic-title first"><strong>Before we start: installing the software</strong></p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">2.1. Getting ready: installing the software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation">2.1.1. Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="install.html#sanity-check">2.1.1.1. Sanity check</a></li>
<li class="toctree-l3"><a class="reference internal" href="install.html#download-the-neurodebian-virtual-machine">2.1.1.2. Download the neurodebian virtual machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="install.html#install-virtualbox">2.1.1.3. Install VirtualBox</a></li>
<li class="toctree-l3"><a class="reference internal" href="install.html#configure-the-neurodebian-virtual-machine">2.1.1.4. Configure the neurodebian virtual machine</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="activation-irmf">
<h2>2.2. Activation IRMf<a class="headerlink" href="#activation-irmf" title="Permalink to this headline">¶</a></h2>
<p>Why do we do activation fMRI?  Basically: localization Hypothesis:
functional specialization Aim: given a target process, detect the brain
areas involved Principle: the experimenter imposes on the subject a
temporal variation related to the target process and looks for whichever
part of the brain displays a signal in which the same variation could be
found.</p>
<p>=&gt; we need to get the time series of BOLD signal AND the time series of
what happened to the subject AND they both have to be synchonous!</p>
<p>also</p>
<ul class="simple">
<li>resting state fMRI</li>
<li>more than localization: connectivity</li>
</ul>
</div>
<div class="section" id="bold-signal">
<h2>2.3. BOLD signal<a class="headerlink" href="#bold-signal" title="Permalink to this headline">¶</a></h2>
<p>BOLD signal: local vascular changes somehow related to increased brain
activity can be detected by a MRI scanner (T2* signal increases).
However the fluctuation of the signal induced by the BOLD effect is about
few percents.</p>
</div>
<div class="section" id="fmri-stimulation-data">
<h2>2.4. fMRI stimulation data<a class="headerlink" href="#fmri-stimulation-data" title="Permalink to this headline">¶</a></h2>
<p>Same time reference than the MRI acquisitions.  Describe the time series
of conditions.</p>
<p>Reminder: we are looking for voxels in which part of the signal variance
is explained by our manipulation, thus we need to know what is the
shape of the temporal variation induces by our experimental paradigm.</p>
<p>Let&#8217;s start with a basi example taken from a classical auditory
stimulation dataset (exerpt from the SPM manual describing the
paradigm):</p>
<div class="highlight-python"><div class="highlight"><pre>This data set comprises whole brain BOLD/EPI images acquired on a
<div class="newline"></div>modified 2T Siemens MAGNETOM Vision system. Each acquisition consisted
<div class="newline"></div>of 64 contiguous slices (64×64×64 3×3mm×3 mm3 voxels). Acquisition took
<div class="newline"></div>6.05s, with the scan to scan repeat time (TR) set arbitrarily to 7s.
<div class="newline"></div>96 acquisitions were made (TR=7s) from a single subject, in blocks of 6,
<div class="newline"></div>giving 16 42s blocks. The condition for successive blocks alternated
<div class="newline"></div>between rest and auditory stimulation, starting with rest. Auditory
<div class="newline"></div>stimulation was bi-syllabic words presented binaurally at a rate of 60
<div class="newline"></div>per minute. The functional data starts at acquisition 4
<div class="newline"></div>
<div class="newline"></div>To avoid T1 effects in the initial scans of an fMRI time series we
<div class="newline"></div>recommend discarding the first few scans. To make this example simple,
<div class="newline"></div>we’ll discard the first complete cycle (12 scans, 04-15), leaving 84
<div class="newline"></div>scans, image files 16-99.
<div class="newline"></div></pre></div>
</div>
<p>Two different ways of defining a regressor</p>
<ol class="arabic">
<li><p class="first">manually:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">reg</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">reg</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">reg</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">using a .csv file which defines in different columns the runs, the
conditions, the onset time and the duration.</p>
</li>
</ol>
</div>
<div class="section" id="convolution">
<h2>2.5. Convolution<a class="headerlink" href="#convolution" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">nipy.modalities.fmri.hemodynamic_models</span> <span class="kn">as</span> <span class="nn">hm</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">hrf</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">spm_hrf</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">oversampling</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">hrf</span><span class="p">))</span>
<div class="newline"></div></pre></div>
</div>
<p>Try to play a bit with the convolution using different regressors</p>
</div>
<div class="section" id="fmri-scanner-data">
<h2>2.6. fMRI scanner data<a class="headerlink" href="#fmri-scanner-data" title="Permalink to this headline">¶</a></h2>
<p>As usual, we would like to measure a variation =&gt; temporal resolution
Localization =&gt; spatial resolution Trade-off : it takes more time to
acquire more data points.</p>
<p>The MRI scanner allows the BOLD signal to be recorded in a given space
where the experimenter puts the object to measure, in our case, a living
brain (and around: the human that sustains it).</p>
<p>Scanner =&gt; sequential acquisition of data</p>
<ul class="simple">
<li>2D: one slice n * n voxels (a voxel is an element of volume, think 3D
pixel)</li>
<li>3D: many slices = one volume, which usually covers the whole brain</li>
<li>4D: time series of sequentially acquired volumes == for each voxel, we
get a time series</li>
</ul>
<p>Let&#8217;s look at the data:</p>
<p>Few words about DICOM files and nifti
Conversion:
Application Menu-&gt;NeuroDebian-&gt;Medical Imaging -&gt; dcm2nii:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nipy</span> <span class="kn">import</span> <span class="n">load_image</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="o">=</span><span class="n">load_image</span><span class="p">(</span><span class="s">&#39;host/python-cogstats/examples/wrf4d.nii.gz&#39;</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<div class="newline"></div></pre></div>
</div>
<p>Now you can play with python in order to visualize</p>
<ol class="arabic simple">
<li>a slice</li>
<li>a volume</li>
<li>a time series in a given voxel</li>
</ol>
<p>Now, try to get some time series using
Application Menu-&gt;NeuroDebian-&gt;Medical Imaging -&gt; FSLview</p>
<p>Conclusions about the signal characteristics:</p>
<ul class="simple">
<li>NOISY!!!!</li>
<li>Highly correlated, spatially, temporally!</li>
<li>spatial resolution</li>
<li>temporal resolution</li>
<li>different sources of variations</li>
</ul>
<p>Remember, the fluctuation induced by brain activity is few percents =&gt;
measurement of a small effect size in huge noise =&gt; need for a LOT of
repetition!  =&gt; substractive approach</p>
</div>
<div class="section" id="analysis-principle">
<h2>2.7. Analysis principle<a class="headerlink" href="#analysis-principle" title="Permalink to this headline">¶</a></h2>
<p>As said earlier, the idea is to find voxels in which the regressor
describing a condition has some effect on the BOLD signal. Each regressor
is actually explaining a part of the variance in a Linear Model</p>
</div>
<div class="section" id="analysis-example">
<h2>2.8. Analysis example<a class="headerlink" href="#analysis-example" title="Permalink to this headline">¶</a></h2>
<p>The first example file is &#8216;host/examples/plot_auditory_analysis.py&#8217;.</p>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong></p>
<ul class="simple">
<li>Run the example.</li>
<li>Change the .csv file to make it match the actual paradigm.</li>
<li>Compare with a random-generated regressor.</li>
<li>Remarks?</li>
</ul>
</div>
</div>
<div class="section" id="contrasts-for-t-and-f-tests">
<h2>2.9. Contrasts for T- and F-tests<a class="headerlink" href="#contrasts-for-t-and-f-tests" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>T-tests are used to compare the contributions of different regressors :
one contrast vector</li>
<li>F-tests are used to compare a model to a submodel (same as
anova(model0,model 1) in R) : matrix identifying regressors that will
NOT be in the submodel</li>
</ul>
</div>
<div class="section" id="another-example">
<h2>2.10. Another example<a class="headerlink" href="#another-example" title="Permalink to this headline">¶</a></h2>
<p>The second example file is &#8216;host/examples/plot_localizer_analysis.py&#8217;</p>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong></p>
<ul class="simple">
<li>Define some interesting contrasts prior to the analysis.</li>
<li>Run the example.</li>
</ul>
</div>
</div>
<div class="section" id="multiple-comparisons">
<h2>2.11. Multiple comparisons<a class="headerlink" href="#multiple-comparisons" title="Permalink to this headline">¶</a></h2>
<p>Several strategies.</p>
<ol class="arabic simple">
<li>Voxel-level<ul>
<li>Uncorrected (silly)</li>
<li>Family-Wise: Bonferroni and others (only type I risk)</li>
<li>Estimation of independant elements of volume related to
the spatial correlation: Random Field Theory</li>
<li>False Discovery Rate (type I and type II risks)</li>
<li>Reduce the number of voxels for the correction (ROI)</li>
</ul>
</li>
</ol>
<p>Number of voxels on which the model is estimated:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fmri_glm</span><span class="o">.</span><span class="n">glms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_beta</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fmri_glm</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<dl class="docutils">
<dt>cumulative</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.001</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
</dd>
</dl>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong></p>
<ol class="arabic simple">
<li>Caclulate a Bonferroni-correcter threshold</li>
<li>Apply</li>
</ol>
</div>
<ol class="arabic simple" start="2">
<li>Cluster-level<ul>
<li>Permutation test</li>
</ul>
</li>
</ol>
<div class="green topic">
<p class="topic-title first"><strong>Exercise</strong></p>
<ol class="arabic simple">
<li>From the Z-map of a contrast, retrieve cluster sizes.</li>
<li>Sort the Cluster sizes.</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Z</span> <span class="o">=</span> <span class="n">z_map</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">cluster_map</span><span class="p">,</span> <span class="n">n_clusters</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.5</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">cluster_sizes_h0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">cluster_map</span><span class="o">.</span><span class="n">ravel</span><span class="p">())[</span><span class="mi">1</span><span class="p">:])</span>
<div class="newline"></div></pre></div>
</div>
<ol class="arabic simple" start="3">
<li>What is the relathinship between the permutation and H0?</li>
<li>What is permuted exactly?</li>
<li>Run the file &#8216;host/python-cogstats/examples/plot_permutation.py&#8217;</li>
</ol>
</div>
</div>
<div class="section" id="second-level-analysis">
<h2>2.12. Second-level analysis<a class="headerlink" href="#second-level-analysis" title="Permalink to this headline">¶</a></h2>
<p>Is related to between-subject comparison.
Fixed or Random effect analysis.
Necessitate normalization.</p>
<p><div style="clear: both"></div></p>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="install.html" title="2.1. Getting ready: installing the software"
             >next</a></li>
        <li class="right" >
          <a href="basic_statistics.html" title="1. Basic statistics"
             >previous</a> |</li>
        <li><a href="index.html">Statistics for the CogMaster</a> &raquo;</li>
     
    <!-- Insert a menu in the navigation bar -->
    <li class="left">
	<!-- On click toggle the 'tip' on or off-->
	<a onclick="$('.tip').each(function (index, obj) {
			    collapse_tip_div(obj);
		    });
		    $('.tip').addClass('collapsed');
		    $('.left').addClass('transparent');">
	<img src="_static/minus.png"
         alt="Collapse to compact view" style="padding: 1ex;"/>
	<span class="hiddenlink">Collapse document to compact view</span>
    </a></li>

      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012,2013.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>